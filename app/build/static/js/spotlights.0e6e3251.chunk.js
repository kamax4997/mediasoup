(this["webpackJsonpmultiparty-meeting"]=this["webpackJsonpmultiparty-meeting"]||[]).push([[10],{666:function(t,e,i){"use strict";i.r(e),i.d(e,"default",(function(){return p}));var s=i(31),n=i(57),h=i(45),l=i(58),r=i(72),o=i(73),a=i(208),u=new(i(96).a)("Spotlight"),p=function(t){Object(r.a)(i,t);var e=Object(o.a)(i);function i(t,s){var n;return Object(h.a)(this,i),(n=e.call(this))._signalingSocket=s,n._maxSpotlights=t,n._peerList=[],n._unmutablePeerList=[],n._selectedSpotlights=[],n._fixedSpotlight=[],n._currentSpotlights=[],n._started=!1,n._page=0,n._roomType="",n}return Object(l.a)(i,[{key:"start",value:function(){this._handleSignaling(),this._started=!0,this._spotlightsUpdated()}},{key:"addPeers",value:function(t){var e,i=Object(n.a)(t);try{for(i.s();!(e=i.n()).done;){var s=e.value;this._newPeer(s.id)}}catch(h){i.e(h)}finally{i.f()}}},{key:"setPage",value:function(t){this._page=t,this._spotlightsUpdated()}},{key:"setRoomType",value:function(t){console.log("setting roomType: "+t),this._roomType=t}},{key:"getPage",value:function(t){return this._page}},{key:"peerInSpotlights",value:function(t){return!!this._started&&-1!==this._currentSpotlights.indexOf(t)}},{key:"getCurrent",value:function(){return this._currentSpotlights}},{key:"getNextAsSelected",value:function(t){var e=null;if(null==t&&this._unmutablePeerList.length>0&&(t=this._unmutablePeerList[0]),null!=t&&this._currentSpotlights.length<this._unmutablePeerList.length){var i=this._unmutablePeerList.indexOf(t);i++;for(var s=0;s<this._unmutablePeerList.length&&(i>=this._unmutablePeerList.length&&(i=0),e=this._unmutablePeerList[i],this._currentSpotlights.includes(e));s++)i++}return e}},{key:"getPrevAsSelected",value:function(t){var e=null;if(null==t&&this._unmutablePeerList.length>0&&(t=this._unmutablePeerList[0]),null!=t&&this._currentSpotlights.length<this._unmutablePeerList.length){var i=this._unmutablePeerList.indexOf(t);i--;for(var s=0;s<this._unmutablePeerList.length&&(i<0&&(i=this._unmutablePeerList.length-1),e=this._unmutablePeerList[i],this._currentSpotlights.includes(e));s++)i--}return e}},{key:"setPeerSpotlight",value:function(t){u.debug('setPeerSpotlight() [peerId:"%s"]',t);var e=this._selectedSpotlights.indexOf(t);"none"!=t&&(this._selectedSpotlights=-1!==e?[]:[t]),this._started&&this._spotlightsUpdated()}},{key:"setFixedSpotlight",value:function(t){if(u.debug('setPeerSpotlight() [peerId:"%s"]',t),"none"!=t){this._selectedSpotlights.indexOf(t);this._selectedSpotlights=[t],this._fixedSpotlight=[]}console.log("this._roomType: spotlights after fixed "+this._selectedSpotlights),this._started&&this._spotlightsUpdated()}},{key:"_handleSignaling",value:function(){var t=this;this._signalingSocket.on("notification",(function(e){if("newPeer"===e.method){var i=e.data.id;t._newPeer(i)}if("peerClosed"===e.method){var s=e.data.peerId;t._closePeer(s)}}))}},{key:"clearSpotlights",value:function(){this._started=!1,this._peerList=[],this._selectedSpotlights=[],this._currentSpotlights=[],console.log("this._roomType: clear spotlights ")}},{key:"_newPeer",value:function(t){u.debug('room "newpeer" event [id: "%s"]',t),-1===this._peerList.indexOf(t)&&(u.debug('_handlePeer() | adding peer [peerId: "%s"]',t),this._peerList.push(t),this._unmutablePeerList.push(t),this._started&&this._spotlightsUpdated())}},{key:"_closePeer",value:function(t){u.debug('room "peerClosed" event [peerId:%o]',t),this._peerList=this._peerList.filter((function(e){return e!==t})),this._unmutablePeerList=this._unmutablePeerList.filter((function(e){return e!==t})),this._selectedSpotlights=this._selectedSpotlights.filter((function(e){return e!==t})),this._started&&this._spotlightsUpdated()}},{key:"addSpeakerList",value:function(t){this._peerList=Object(s.a)(new Set([].concat(Object(s.a)(t),Object(s.a)(this._peerList)))),this._started&&this._spotlightsUpdated()}},{key:"handleActiveSpeaker",value:function(t){u.debug('handleActiveSpeaker() [peerId:"%s"]',t);var e=this._peerList.indexOf(t);e>-1&&(this._peerList.splice(e,1),this._peerList=[t].concat(this._peerList),this._spotlightsUpdated())}},{key:"getPeersLength",value:function(){return this._peerList.length}},{key:"_spotlightsUpdated",value:function(){var t;t=this._selectedSpotlights.length>0?Object(s.a)(new Set([].concat(Object(s.a)(this._selectedSpotlights),Object(s.a)(this._peerList)))):this._peerList;var e=this._page*this._maxSpotlights,i=e+this._maxSpotlights;i>this._peerList.length&&(i=this._peerList.length),this._arraysEqual(this._currentSpotlights,t.slice(e,i))?u.debug("_spotlightsUpdated() | spotlights not updated"):(u.debug("_spotlightsUpdated() | spotlights updated, emitting"),this._currentSpotlights=t.slice(e,i),console.log("varun this._roomType: spotlights "+this._selectedSpotlights),console.log("varun this._roomType: before "+this._currentSpotlights),console.log("varun this._roomType: fixed "+this._fixedSpotlight),t=[].concat(Object(s.a)(this._currentSpotlights),Object(s.a)(this._selectedSpotlights),Object(s.a)(this._fixedSpotlight)),this._currentSpotlights=t,console.log("varun this._roomType: after "+this._currentSpotlights),this.emit("spotlights-updated",this._currentSpotlights))}},{key:"_arraysEqual",value:function(t,e){if(t.length!==e.length)return!1;for(var i=t.length;i--;)if(t[i]!==e[i])return!1;return!0}},{key:"maxSpotlights",get:function(){return this._maxSpotlights},set:function(t){var e=this._maxSpotlights;this._maxSpotlights=t,e!==this._maxSpotlights&&(this._page=0,this._spotlightsUpdated())}}]),i}(a.EventEmitter)}}]);
//# sourceMappingURL=spotlights.0e6e3251.chunk.js.map